{"title":"懒加载(lazyload/lozad)和Valine评论系统的头像、表情冲突","uid":"fbf2013fd372815138afff9263093bc8","slug":"lazyload-bug","date":"2022-05-12T13:49:09.000Z","updated":"2022-05-12T15:44:38.743Z","comments":true,"path":"api/articles/lazyload-bug.json","keywords":null,"cover":[],"content":"<h2 id=\"问题现象\"><a href=\"#问题现象\" class=\"headerlink\" title=\"问题现象\"></a>问题现象</h2><p>在使用lozad.js的情况下，同时使用了Valine评论系统，就会出现头像、表情不显示的问题。百度也一直找不到问题所在。</p>\n<p>如图</p>\n<img src=\"https://img1.i-nmb.cn/img/image-20220512221221660.png\" alt=\"头像不显示\" style=\"zoom:80%;\" />\n\n<img src=\"https://img1.i-nmb.cn/img/image-20220512221511083.png\" alt=\"表情不显示\" style=\"zoom:80%;\" />\n\n<h2 id=\"问题分析\"><a href=\"#问题分析\" class=\"headerlink\" title=\"问题分析\"></a>问题分析</h2><p>在F12开发者工具下，看到所有的src变成了data-src，导致了src没有数据</p>\n<p><img src=\"https://img1.i-nmb.cn/img/image-20220512221829449.png\" alt=\"data-src\"></p>\n<p>查看代码，发现他把src一律转换成了data-src。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;*! lozad.js - v1.16.0 - 2020-09-06\n* https:&#x2F;&#x2F;github.com&#x2F;ApoorvSaxena&#x2F;lozad.js\n* Copyright (c) 2020 Apoorv Saxena; Licensed MIT *&#x2F;\n!function(t,e)&#123;&quot;object&quot;&#x3D;&#x3D;typeof exports&amp;&amp;&quot;undefined&quot;!&#x3D;typeof module?module.exports&#x3D;e():&quot;function&quot;&#x3D;&#x3D;typeof define&amp;&amp;define.amd?define(e):t.lozad&#x3D;e()&#125;(this,function()&#123;&quot;use strict&quot;;\n&#x2F;**\n   * Detect IE browser\n   * @const &#123;boolean&#125;\n   * @private\n   *&#x2F;var g&#x3D;&quot;undefined&quot;!&#x3D;typeof document&amp;&amp;document.documentMode,f&#x3D;&#123;rootMargin:&quot;0px&quot;,threshold:0,load:function(t)&#123;if(&quot;picture&quot;&#x3D;&#x3D;&#x3D;t.nodeName.toLowerCase())&#123;var e&#x3D;t.querySelector(&quot;img&quot;),r&#x3D;!1;null&#x3D;&#x3D;&#x3D;e&amp;&amp;(e&#x3D;document.createElement(&quot;img&quot;),r&#x3D;!0),g&amp;&amp;t.getAttribute(&quot;data-iesrc&quot;)&amp;&amp;(e.src&#x3D;t.getAttribute(&quot;data-iesrc&quot;)),t.getAttribute(&quot;data-alt&quot;)&amp;&amp;(e.alt&#x3D;t.getAttribute(&quot;data-alt&quot;)),r&amp;&amp;t.append(e)&#125;if(&quot;video&quot;&#x3D;&#x3D;&#x3D;t.nodeName.toLowerCase()&amp;&amp;!t.getAttribute(&quot;data-src&quot;)&amp;&amp;t.children)&#123;for(var a&#x3D;t.children,o&#x3D;void 0,i&#x3D;0;i&lt;&#x3D;a.length-1;i++)(o&#x3D;a[i].getAttribute(&quot;data-src&quot;))&amp;&amp;(a[i].src&#x3D;o);t.load()&#125;t.getAttribute(&quot;data-poster&quot;)&amp;&amp;(t.poster&#x3D;t.getAttribute(&quot;data-poster&quot;)),t.getAttribute(&quot;data-src&quot;)&amp;&amp;(t.src&#x3D;t.getAttribute(&quot;data-src&quot;)),t.getAttribute(&quot;data-srcset&quot;)&amp;&amp;t.setAttribute(&quot;srcset&quot;,t.getAttribute(&quot;data-srcset&quot;));var n&#x3D;&quot;,&quot;;if(t.getAttribute(&quot;data-background-delimiter&quot;)&amp;&amp;(n&#x3D;t.getAttribute(&quot;data-background-delimiter&quot;)),t.getAttribute(&quot;data-background-image&quot;))t.style.backgroundImage&#x3D;&quot;url(&#39;&quot;+t.getAttribute(&quot;data-background-image&quot;).split(n).join(&quot;&#39;),url(&#39;&quot;)+&quot;&#39;)&quot;;else if(t.getAttribute(&quot;data-background-image-set&quot;))&#123;var d&#x3D;t.getAttribute(&quot;data-background-image-set&quot;).split(n),u&#x3D;d[0].substr(0,d[0].indexOf(&quot; &quot;))||d[0];&#x2F;&#x2F; Substring before ... 1x\nu&#x3D;-1&#x3D;&#x3D;&#x3D;u.indexOf(&quot;url(&quot;)?&quot;url(&quot;+u+&quot;)&quot;:u,1&#x3D;&#x3D;&#x3D;d.length?t.style.backgroundImage&#x3D;u:t.setAttribute(&quot;style&quot;,(t.getAttribute(&quot;style&quot;)||&quot;&quot;)+&quot;background-image: &quot;+u+&quot;; background-image: -webkit-image-set(&quot;+d+&quot;); background-image: image-set(&quot;+d+&quot;)&quot;)&#125;t.getAttribute(&quot;data-toggle-class&quot;)&amp;&amp;t.classList.toggle(t.getAttribute(&quot;data-toggle-class&quot;))&#125;,loaded:function()&#123;&#125;&#125;;function A(t)&#123;t.setAttribute(&quot;data-loaded&quot;,!0)&#125;var m&#x3D;function(t)&#123;return&quot;true&quot;&#x3D;&#x3D;&#x3D;t.getAttribute(&quot;data-loaded&quot;)&#125;,v&#x3D;function(t)&#123;var e&#x3D;1&lt;arguments.length&amp;&amp;void 0!&#x3D;&#x3D;arguments[1]?arguments[1]:document;return t instanceof Element?[t]:t instanceof NodeList?t:e.querySelectorAll(t)&#125;;return function()&#123;var r,a,o&#x3D;0&lt;arguments.length&amp;&amp;void 0!&#x3D;&#x3D;arguments[0]?arguments[0]:&quot;.lozad&quot;,t&#x3D;1&lt;arguments.length&amp;&amp;void 0!&#x3D;&#x3D;arguments[1]?arguments[1]:&#123;&#125;,e&#x3D;Object.assign(&#123;&#125;,f,t),i&#x3D;e.root,n&#x3D;e.rootMargin,d&#x3D;e.threshold,u&#x3D;e.load,g&#x3D;e.loaded,s&#x3D;void 0;&quot;undefined&quot;!&#x3D;typeof window&amp;&amp;window.IntersectionObserver&amp;&amp;(s&#x3D;new IntersectionObserver((r&#x3D;u,a&#x3D;g,function(t,e)&#123;t.forEach(function(t)&#123;(0&lt;t.intersectionRatio||t.isIntersecting)&amp;&amp;(e.unobserve(t.target),m(t.target)||(r(t.target),A(t.target),a(t.target)))&#125;)&#125;),&#123;root:i,rootMargin:n,threshold:d&#125;));for(var c,l&#x3D;v(o,i),b&#x3D;0;b&lt;l.length;b++)(c&#x3D;l[b]).getAttribute(&quot;data-placeholder-background&quot;)&amp;&amp;(c.style.background&#x3D;c.getAttribute(&quot;data-placeholder-background&quot;));return&#123;observe:function()&#123;for(var t&#x3D;v(o,i),e&#x3D;0;e&lt;t.length;e++)m(t[e])||(s?s.observe(t[e]):(u(t[e]),A(t[e]),g(t[e])))&#125;,triggerLoad:function(t)&#123;m(t)||(u(t),A(t),g(t))&#125;,observer:s&#125;&#125;&#125;);</code></pre>\n\n\n\n<p>所以我们使用<code>srcset</code>代替<code>Valine.min.js</code>中的<code>src</code></p>\n<h2 id=\"具体解决方法\"><a href=\"#具体解决方法\" class=\"headerlink\" title=\"具体解决方法\"></a>具体解决方法</h2><p>使用<code>srcset</code>代替<code>Valine.min.js</code>中的<code>src</code></p>\n<p>首先我们先下载js文件到本地：<a href=\"https://cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js\">下载地址</a></p>\n<p>搜索<code>&lt;img</code></p>\n<p><img src=\"https://img1.i-nmb.cn/img/image-20220512223914575.png\" alt=\"搜索&lt;img\"></p>\n<p>然后在<code>&lt;img</code>后面的<code>src</code>替换为<code>srcset</code></p>\n<p>并将更改好的js放在<code>Blog\\source</code>中的某个地方</p>\n<p>接下来在CDN引用的地方，修改路径为<code>/js1/Valine.min.js</code>【笔者放在Blog&#x2F;source&#x2F;js1&#x2F;Valine.min.js】</p>\n<p><img src=\"https://img1.i-nmb.cn/img/image-20220512230334642.png\" alt=\"修改路径\"></p>\n<p>然后保存，最后<code>hexo cl &amp;&amp; hexo g &amp;&amp; hexo s</code></p>\n<h2 id=\"问题解决\"><a href=\"#问题解决\" class=\"headerlink\" title=\"问题解决\"></a>问题解决</h2><p>看结果，</p>\n<p><img src=\"https://img1.i-nmb.cn/img/image-20220512224151163.png\" alt=\"修护完成\"></p>\n","text":"问题现象在使用lozad.js的情况下，同时使用了Valine评论系统，就会出现头像、表情不显示的问题。百度也一直找不到问题所在。 如图 问题分析在F12开发者工具下，看到所有的src变成了data-src，导致了src没有数据 查看代码，发现他把src一律转换成了data-sr...","link":"","photos":[],"count_time":{"symbolsCount":"4.9k","symbolsTime":"4 mins."},"categories":[],"tags":[{"name":"hexo","slug":"hexo","count":5,"path":"api/tags/hexo.json"},{"name":"NexT","slug":"NexT","count":5,"path":"api/tags/NexT.json"},{"name":"lozad","slug":"lozad","count":1,"path":"api/tags/lozad.json"},{"name":"Valine","slug":"Valine","count":1,"path":"api/tags/Valine.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%97%AE%E9%A2%98%E7%8E%B0%E8%B1%A1\"><span class=\"toc-text\">问题现象</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90\"><span class=\"toc-text\">问题分析</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%85%B7%E4%BD%93%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">具体解决方法</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3\"><span class=\"toc-text\">问题解决</span></a></li></ol>","author":{"name":"ACbug","slug":"blog-author","avatar":"https://img1.i-nmb.cn/ava.png","link":"/","description":"西北民族大学数学与计算机科学学院<br>系统与软件工作室网络安全组","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"《数据结构》知识总结","uid":"1b543e84ac41cc09af328e6f7689b488","slug":"Structures","date":"2022-05-13T15:03:29.000Z","updated":"2022-05-14T14:36:51.050Z","comments":true,"path":"api/articles/Structures.json","keywords":null,"cover":[],"text":"参考视频：速成数据结构与算法-【期末不挂科】_哔哩哔哩_bilibili 数据结构和算法1.数据结构1）数据: 对客观事物的符号表示 图像、声音等 2）数据元素: 数据的基本单位 学生的信息记录 3）数据项: 构成数据元素的不可分割的最小单位 ​ 一个数据元素可由若干个数据项组成...","link":"","photos":[],"count_time":{"symbolsCount":"5.2k","symbolsTime":"5 mins."},"categories":[],"tags":[{"name":"-数据结构","slug":"数据结构","count":1,"path":"api/tags/数据结构.json"}],"author":{"name":"ACbug","slug":"blog-author","avatar":"https://img1.i-nmb.cn/ava.png","link":"/","description":"西北民族大学数学与计算机科学学院<br>系统与软件工作室网络安全组","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Java对象和类—JAVA语言基础","uid":"476613efa9f6b315a06dafe6bc2ebd45","slug":"Class-and-object","date":"2022-05-09T12:32:46.000Z","updated":"2022-05-09T14:37:48.980Z","comments":true,"path":"api/articles/Class-and-object.json","keywords":null,"cover":[],"text":" 对象：对象是类的一个实例（对象不是找个女朋友），有状态和行为。例如，一条狗是一个对象，它的状态有：颜色、名字、品种；行为有：摇尾巴、叫、吃等。 类：类是一个模板，它描述一类对象的行为和状态。 下面我们大致具体了解一下在Java中类和面向对象 面向对象概述对象对象是事物存在的实体...","link":"","photos":[],"count_time":{"symbolsCount":"3.5k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"Java","slug":"Java","count":8,"path":"api/tags/Java.json"},{"name":"Eclipse","slug":"Eclipse","count":7,"path":"api/tags/Eclipse.json"}],"author":{"name":"ACbug","slug":"blog-author","avatar":"https://img1.i-nmb.cn/ava.png","link":"/","description":"西北民族大学数学与计算机科学学院<br>系统与软件工作室网络安全组","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}